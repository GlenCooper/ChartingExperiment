<!DOCTYPE html>
<html>
<head>
    <title>BTC ATH World Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/leaflet-choropleth"></script>
    <style>
        #map {
            height: 1000px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">Countries Where BTC Has Hit ATH</div>
    <div id="map"></div>
    <script>
        // Sample data: Country codes and values
        const countryData = {
            "USA": 10,
            "CAN": 20,
            "BRA": 30,
            "ARG": 40,
            "FRA": 50,
            "DEU": 60,
            "RUS": 70,
            "CHN": 80,
            "IND": 90,
            "AUS": 100,
            "ZAF": 110,
            "EGY": 120,
            "SAU": 130,
            "IRN": 140,
            "TUR": 150,
            "GBR": 160,
            "ESP": 170,
            "ITA": 180,
            "SWE": 190,
            "NOR": 200
        };

        // Initialize the map with a more "globe-like" initial view
        const map = L.map('map', {
            center: [20, 0],
            zoom: 2,
            maxBounds: [[-90, -180], [90, 180]], // Restrict map to world bounds to prevent infinite scrolling
            maxBoundsViscosity: 1.0, // Make the map bound limits "sticky"
        });

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Function to set the color based on the value
        function getColor(value) {
            return value > 180 ? '#800026' :
                   value > 160 ? '#BD0026' :
                   value > 140 ? '#E31A1C' :
                   value > 120 ? '#FC4E2A' :
                   value > 100 ? '#FD8D3C' :
                   value > 80  ? '#FEB24C' :
                   value > 60  ? '#FED976' :
                                 '#FFEDA0';
        }

        // Function to style each feature
        function style(feature) {
            return {
                fillColor: getColor(countryData[feature.properties.adm0_a3] || 0),
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        // Function to handle mouseover event
        function highlightFeature(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
        }

        // Function to reset highlight
        function resetHighlight(e) {
            geojson.resetStyle(e.target);
        }

        // Fetch and add GeoJSON layer
        fetch('https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_110m_admin_0_countries.geojson')
            .then(response => response.json())
            .then(data => {
                geojson = L.geoJson(data, {
                    style: style,
                    onEachFeature: function (feature, layer) {
                        layer.on({
                            mouseover: highlightFeature,
                            mouseout: resetHighlight
                        });
                        layer.bindTooltip(`${feature.properties.admin}: ${countryData[feature.properties.adm0_a3] || 'No data'}`, {permanent: false, direction: 'auto'});
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>
